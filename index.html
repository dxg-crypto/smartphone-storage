import React, { useState, useMemo } from 'react';
import { Camera, Video, Gamepad2, HardDrive, Info, CheckCircle2, AlertCircle, ChevronRight } from 'lucide-react';

const App = () => {
  // ステート管理
  const [photosPerMonth, setPhotosPerMonth] = useState(100);
  const [videoSdMinutes, setVideoSdMinutes] = useState(10);
  const [video4kMinutes, setVideo4kMinutes] = useState(5);
  const [appLevel, setAppLevel] = useState('standard'); // 'low', 'standard', 'high'

  // 定数定義 (MB単位)
  const PHOTO_SIZE = 5;
  const VIDEO_SD_SIZE = 150;
  const VIDEO_4K_SIZE = 400;
  const SYSTEM_SIZE = 30 * 1024; // 30GB

  const APP_SIZES = {
    low: 10 * 1024,      // 10GB
    standard: 30 * 1024, // 30GB
    high: 100 * 1024,    // 100GB
  };

  // 計算ロジック
  const calculations = useMemo(() => {
    const monthlyUsageMB = 
      (photosPerMonth * PHOTO_SIZE) + 
      (videoSdMinutes * VIDEO_SD_SIZE) + 
      (video4kMinutes * VIDEO_4K_SIZE);

    const year1TotalGB = (SYSTEM_SIZE + APP_SIZES[appLevel] + (monthlyUsageMB * 12)) / 1024;
    const year2TotalGB = (SYSTEM_SIZE + APP_SIZES[appLevel] + (monthlyUsageMB * 24)) / 1024;

    let recommendation = "128GB";
    let color = "text-emerald-600";
    let advice = "現在の利用ペースであれば、標準的な128GBモデルでも十分余裕を持ってご利用いただけます。";

    if (year2TotalGB > 450) {
      recommendation = "1TB";
      color = "text-purple-600";
      advice = "非常に多くのデータを保存される予定です。1TBモデルなら、容量不足を気にせず最高画質の動画もたくさん残せます。";
    } else if (year2TotalGB > 220) {
      recommendation = "512GB";
      color = "text-blue-600";
      advice = "動画撮影やゲームを頻繁に楽しまれる方に最適です。数年先を見越して512GBを選んでおくと安心です。";
    } else if (year2TotalGB > 100) {
      recommendation = "256GB";
      color = "text-indigo-600";
      advice = "写真や動画が少しずつ増えていくことを考えると、256GBが最もコストパフォーマンスが良く、長く快適に使えます。";
    }

    return {
      year1: Math.round(year1TotalGB),
      year2: Math.round(year2TotalGB),
      recommendation,
      color,
      advice,
      monthly: (monthlyUsageMB / 1024).toFixed(1)
    };
  }, [photosPerMonth, videoSdMinutes, video4kMinutes, appLevel]);

  return (
    <div className="min-h-screen bg-slate-50 text-slate-900 font-sans p-4 md:p-8">
      <div className="max-w-2xl mx-auto">
        {/* ヘッダー */}
        <header className="text-center mb-8">
          <h1 className="text-2xl md:text-3xl font-bold text-slate-800 mb-2 flex items-center justify-center gap-2">
            <HardDrive className="text-blue-500" />
            ストレージ容量ピッタリ診断
          </h1>
          <p className="text-slate-500 text-sm">お客様のライフスタイルに合わせた最適なスマホ容量を算出します</p>
        </header>

        <div className="space-y-6">
          {/* 入力セクション */}
          <section className="bg-white rounded-3xl shadow-sm border border-slate-100 p-6 space-y-8">
            {/* 写真 */}
            <div className="space-y-4">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <div className="p-2 bg-orange-100 rounded-lg text-orange-600">
                    <Camera size={20} />
                  </div>
                  <label className="font-bold text-slate-700">写真の撮影（月間）</label>
                </div>
                <span className="text-xl font-mono font-bold text-orange-600">{photosPerMonth}<small className="text-xs ml-1 text-slate-400">枚</small></span>
              </div>
              <input 
                type="range" min="0" max="1000" step="10" 
                value={photosPerMonth} 
                onChange={(e) => setPhotosPerMonth(parseInt(e.target.value))}
                className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-orange-500"
              />
              <div className="flex justify-between text-xs text-slate-400 px-1">
                <span>0枚</span>
                <span>500枚</span>
                <span>1000枚以上</span>
              </div>
            </div>

            {/* 動画（通常） */}
            <div className="space-y-4">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <div className="p-2 bg-blue-100 rounded-lg text-blue-600">
                    <Video size={20} />
                  </div>
                  <label className="font-bold text-slate-700">通常動画の撮影（月間）</label>
                </div>
                <span className="text-xl font-mono font-bold text-blue-600">{videoSdMinutes}<small className="text-xs ml-1 text-slate-400">分</small></span>
              </div>
              <input 
                type="range" min="0" max="120" step="5" 
                value={videoSdMinutes} 
                onChange={(e) => setVideoSdMinutes(parseInt(e.target.value))}
                className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-500"
              />
              <div className="flex justify-between text-xs text-slate-400 px-1">
                <span>なし</span>
                <span>1時間</span>
                <span>2時間〜</span>
              </div>
            </div>

            {/* 動画（4K） */}
            <div className="space-y-4">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <div className="p-2 bg-red-100 rounded-lg text-red-600">
                    <Video size={20} />
                  </div>
                  <label className="font-bold text-slate-700">高画質/4K動画の撮影（月間）</label>
                </div>
                <span className="text-xl font-mono font-bold text-red-600">{video4kMinutes}<small className="text-xs ml-1 text-slate-400">分</small></span>
              </div>
              <input 
                type="range" min="0" max="60" step="1" 
                value={video4kMinutes} 
                onChange={(e) => setVideo4kMinutes(parseInt(e.target.value))}
                className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-red-500"
              />
              <div className="flex justify-between text-xs text-slate-400 px-1">
                <span>なし</span>
                <span>30分</span>
                <span>1時間以上</span>
              </div>
            </div>

            {/* アプリ・ゲーム */}
            <div className="space-y-4">
              <div className="flex items-center gap-3 mb-2">
                <div className="p-2 bg-purple-100 rounded-lg text-purple-600">
                  <Gamepad2 size={20} />
                </div>
                <label className="font-bold text-slate-700">アプリ・ゲームの利用量</label>
              </div>
              <div className="grid grid-cols-3 gap-3">
                {[
                  { id: 'low', label: '少ない', sub: 'SNS中心' },
                  { id: 'standard', label: '標準', sub: '色々使う' },
                  { id: 'high', label: '多い', sub: 'ゲーム中心' }
                ].map((item) => (
                  <button
                    key={item.id}
                    onClick={() => setAppLevel(item.id)}
                    className={`flex flex-col items-center justify-center p-3 rounded-2xl border-2 transition-all ${
                      appLevel === item.id 
                        ? 'border-purple-500 bg-purple-50 text-purple-700 shadow-md ring-2 ring-purple-200 ring-opacity-50' 
                        : 'border-slate-100 bg-white text-slate-500 hover:border-slate-200'
                    }`}
                  >
                    <span className="text-sm font-bold">{item.label}</span>
                    <span className="text-[10px] opacity-70">{item.sub}</span>
                  </button>
                ))}
              </div>
            </div>
          </section>

          {/* 結果表示セクション */}
          <section className="space-y-4">
            <div className="bg-white rounded-3xl shadow-xl overflow-hidden border border-slate-100 transition-all duration-500 transform hover:scale-[1.01]">
              <div className="bg-slate-800 p-4 text-white flex justify-between items-center">
                <span className="font-bold text-sm">診断結果レポート</span>
                <div className="px-3 py-1 bg-white/20 rounded-full text-[10px] backdrop-blur-md">
                  想定月間増加量: {calculations.monthly}GB
                </div>
              </div>
              
              <div className="p-8">
                <div className="text-center mb-8">
                  <p className="text-slate-500 text-sm mb-1 font-medium">2年後の想定使用容量</p>
                  <div className="flex items-baseline justify-center gap-1">
                    <span className="text-6xl font-black tracking-tighter text-slate-800">{calculations.year2}</span>
                    <span className="text-2xl font-bold text-slate-400">GB</span>
                  </div>
                  <div className="mt-4 inline-flex items-center gap-2 px-4 py-2 bg-slate-100 rounded-full text-xs text-slate-600">
                    <Info size={14} className="text-slate-400" />
                    <span>システム・初期アプリ(30GB)を含む</span>
                  </div>
                </div>

                <div className="relative p-6 bg-gradient-to-br from-slate-50 to-white rounded-2xl border-2 border-dashed border-slate-200 text-center">
                   <div className="absolute -top-3 left-1/2 -translate-x-1/2 bg-white px-4 text-[10px] font-bold text-slate-400 tracking-widest uppercase">
                    Recommended Capacity
                  </div>
                  <p className="text-slate-600 text-sm mb-2">おすすめの端末容量</p>
                  <p className={`text-5xl font-black mb-4 ${calculations.color}`}>
                    {calculations.recommendation}
                  </p>
                  
                  <div className="flex items-start gap-3 text-left p-4 bg-white rounded-xl shadow-sm border border-slate-100">
                    <CheckCircle2 className={`shrink-0 mt-0.5 ${calculations.color}`} size={18} />
                    <p className="text-sm leading-relaxed text-slate-600 italic">
                      「{calculations.advice}」
                    </p>
                  </div>
                </div>
              </div>

              {/* 容量比較グラフ（簡易） */}
              <div className="px-8 pb-8 space-y-3">
                <div className="flex justify-between text-xs font-bold text-slate-400 px-1">
                  <span>利用開始時</span>
                  <span>1年後</span>
                  <span>2年後</span>
                </div>
                <div className="relative h-4 bg-slate-100 rounded-full overflow-hidden">
                  <div className="absolute top-0 left-0 h-full bg-slate-300 transition-all duration-700" style={{ width: '15%' }}></div>
                  <div className="absolute top-0 left-0 h-full bg-blue-400 transition-all duration-1000" style={{ width: `${Math.min(100, (calculations.year1 / 512) * 100)}%` }}></div>
                  <div className="absolute top-0 left-0 h-full bg-blue-600 transition-all duration-1000" style={{ width: `${Math.min(100, (calculations.year2 / 512) * 100)}%` }}></div>
                </div>
                <div className="flex justify-between text-[10px] text-slate-400">
                  <span>{(SYSTEM_SIZE/1024).toFixed(0)}GB (OS)</span>
                  <span>{calculations.year1}GB</span>
                  <span>{calculations.year2}GB</span>
                </div>
              </div>
            </div>

            {/* ショップ店員向けアドバイス */}
            <div className="bg-amber-50 rounded-2xl p-4 border border-amber-100 flex gap-3">
              <AlertCircle className="text-amber-500 shrink-0" size={20} />
              <div>
                <p className="text-amber-800 text-xs font-bold mb-1">接客のポイント</p>
                <ul className="text-amber-700 text-[11px] space-y-1 list-disc list-inside">
                  <li>「数年使うとOSのアップデートでも容量が少しずつ増えます」</li>
                  <li>「お子様が生まれたり趣味が増えると、今の予想より増える場合が多いです」</li>
                  <li>「iCloudやGoogleドライブ等のクラウド活用も併せてご提案ください」</li>
                </ul>
              </div>
            </div>
          </section>
        </div>

        <footer className="mt-12 text-center text-slate-400 text-[10px] pb-8">
          &copy; 2024 Storage Perfect Diagnosis Service
        </footer>
      </div>
    </div>
  );
};

export default App;
